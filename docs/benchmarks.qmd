---
title: "Benchmarks"
description: "Performance analysis and comparison with SciPy"
---

# Benchmarks

Optyx includes a comprehensive benchmark suite measuring **end-to-end performance** including variable creation, problem setup, constraint construction, and solving. All benchmarks compare against raw SciPy (which has no build phase).

## Quick Start

```bash
# Run all benchmark tests
uv run pytest benchmarks/ -v

# Generate performance analysis plots
uv run python benchmarks/run_benchmarks.py

# Copy plots to docs (for documentation updates)
cp benchmarks/results/*.png docs/assets/benchmarks/
```

::: {.callout-note}
## What We Measure
All benchmarks measure **total time** including:

- Variable creation
- Problem setup  
- Constraint construction
- Cold solve (first solve, includes compilation)
- Warm solve (cached subsequent solves)
:::

## Performance Summary

| Problem Type | Size | Cold Overhead | Warm Overhead | Notes |
|--------------|------|---------------|---------------|-------|
| **LP** | n=50 | 1.6x | 0.9x | Near-parity with SciPy linprog |
| **LP** | n=500 | 1.2x | 1.0x | Warm solves at parity |
| **LP** | n=5000 | 1.1x | 1.1x | Scales to large problems |
| **NLP** | n=50 | 3.3x | 0.6x | Fast warm solves |
| **NLP** | n=500 | 8.9x | **0.2x** | Warm solves 5x faster than SciPy |
| **NLP** | n=5000 | 0.4x | **0.0x** | **800x faster** than SciPy at scale |
| **CQP** | n=50 | 2.0x | 0.9x | O(1) Jacobian compilation |
| **CQP** | n=500 | 1.2x | 1.2x | Near-parity with SciPy |
| **CQP** | n=5000 | 1.0x | 1.0x | Perfect scaling |

**Key Insight**: Cold solves include one-time compilation. Warm solves (repeated optimization with cached structure) achieve near-parity or better than raw SciPy.

---

## LP Scaling: VectorVariable vs Loop-Based

![LP Scaling Comparison](assets/benchmarks/lp_scaling_comparison.png){width=100%}

### Loop-Based Variables (n ≤ 100)

| n | Build | Cold Solve | Warm Solve | SciPy | Cold Overhead | Warm Overhead |
|---|-------|------------|------------|-------|---------------|---------------|
| 10 | 0.2ms | 5.2ms | 1.6ms | 1.1ms | 5.0x | 1.7x |
| 25 | 0.6ms | 8.1ms | 1.3ms | 1.8ms | 4.9x | 1.1x |
| 50 | 5.5ms | 36.9ms | 2.2ms | 2.0ms | 21.6x | 3.9x |
| 100 | 11.1ms | 106.3ms | 3.2ms | 3.8ms | 31.1x | 3.8x |

::: {.callout-warning}
## Loop-Based Variables Don't Scale
Loop-based variable construction creates O(n²) expression tree nodes, causing exponential compilation time. Use VectorVariable for n > 50.
:::

### VectorVariable (n ≤ 5,000)

| n | Build | Cold Solve | Warm Solve | SciPy | Cold Overhead | Warm Overhead |
|---|-------|------------|------------|-------|---------------|---------------|
| 10 | 0.1ms | 2.1ms | 1.3ms | 1.3ms | 1.7x | 1.1x |
| 25 | 0.1ms | 1.6ms | 1.3ms | 1.6ms | 1.0x | 0.9x |
| 50 | 0.2ms | 3.6ms | 2.1ms | 2.4ms | 1.6x | 0.9x |
| 100 | 0.3ms | 4.3ms | 3.5ms | 3.0ms | 1.5x | 1.3x |
| 200 | 0.6ms | 11.9ms | 9.5ms | 9.0ms | 1.4x | 1.1x |
| 500 | 1.6ms | 69.3ms | 58.1ms | 58.7ms | 1.2x | **1.0x** |
| 1000 | 3.2ms | 279.4ms | 210.5ms | 217.6ms | 1.3x | **1.0x** |
| 2000 | 6.3ms | 1,113ms | 932.5ms | 965.2ms | 1.2x | **1.0x** |
| 5000 | 37.4ms | 8,596ms | 8,780ms | 8,207ms | 1.1x | **1.1x** |

**VectorVariable achieves parity or better than raw SciPy** for warm solves at all scales. Cold solve overhead is ~2x due to one-time compilation.

---

## NLP Scaling: Unconstrained Optimization

![NLP Scaling Comparison](assets/benchmarks/nlp_scaling_comparison.png){width=100%}

Objective: `min Σx²ᵢ - Σxᵢ` (optimal at x* = 0.5)

### VectorVariable with `x.dot(x) - x.sum()`

| n | Build | Cold Solve | Warm Solve | SciPy | Cold Overhead | Warm Overhead |
|---|-------|------------|------------|-------|---------------|---------------|
| 10 | 0.0ms | 1.3ms | 0.5ms | 0.3ms | 4.0x | 1.6x |
| 25 | 0.1ms | 2.4ms | 0.6ms | 0.7ms | 3.6x | 1.0x |
| 50 | 0.1ms | 4.8ms | 0.8ms | 1.5ms | 3.3x | 0.6x |
| 100 | 0.1ms | 16.3ms | 1.1ms | 0.9ms | 18.6x | 1.4x |
| 200 | 0.2ms | 36.9ms | 1.8ms | 3.8ms | 9.8x | **0.5x** |
| 500 | 0.5ms | 135.8ms | 3.0ms | 15.3ms | 8.9x | **0.2x** |
| 1000 | 1.1ms | 608.8ms | 5.9ms | 100.3ms | 6.1x | **0.1x** |
| 2000 | 2.1ms | 1,533ms | 11.4ms | 1,561ms | **1.0x** | **0.01x** |
| 5000 | 11.8ms | 8,911ms | 28.4ms | 22,940ms | **0.4x** | **0.001x** |

::: {.callout-tip}
## At Large Scale, Optyx Can Be Faster
At n=5000, Optyx warm solves are **800x faster** than SciPy due to cached gradient computation and efficient vectorized evaluation.
:::

---

## Constrained QP Scaling

![CQP Scaling Comparison](assets/benchmarks/cqp_scaling_comparison.png){width=100%}

Objective: `min Σx²ᵢ` subject to `Σxᵢ ≥ 1, xᵢ ≥ 0`

### VectorVariable with `x.dot(x)`, `x.sum()`

| n | Build | Cold Solve | Warm Solve | SciPy | Cold Overhead | Warm Overhead |
|---|-------|------------|------------|-------|---------------|---------------|
| 10 | 0.1ms | 1.3ms | 0.4ms | 0.8ms | 1.8x | 0.6x |
| 25 | 0.1ms | 1.8ms | 1.3ms | 1.0ms | 1.8x | 1.3x |
| 50 | 0.1ms | 1.6ms | 0.7ms | 0.8ms | 2.0x | **0.9x** |
| 100 | 0.1ms | 2.3ms | 1.1ms | 1.3ms | 1.9x | 0.9x |
| 200 | 0.2ms | 3.7ms | 3.2ms | 2.0ms | 2.0x | 1.8x |
| 500 | 0.6ms | 19.2ms | 18.5ms | 15.9ms | 1.2x | 1.2x |
| 1000 | 1.2ms | 91.5ms | 99.7ms | 79.7ms | 1.2x | 1.3x |
| 2000 | 2.1ms | 467.7ms | 472.1ms | 479.9ms | 1.0x | **1.0x** |
| 5000 | 5.0ms | 6,432ms | 6,324ms | 6,304ms | 1.0x | **1.0x** |

With O(1) Jacobian computation, constrained problems now achieve parity with SciPy at all scales up to n=5,000.

---

## Overhead Summary by Problem Type

![Overhead Breakdown](assets/benchmarks/overhead_breakdown.png){width=100%}

| Problem Type | Cold Overhead | Warm Overhead |
|--------------|---------------|---------------|
| LP (n=50) | 1.9x | 1.5x |
| LP (n=500) | 1.6x | 1.3x |
| NLP (n=50) | 29.2x | 1.5x |
| NLP (n=500) | 9.0x | **0.2x** |
| CQP (n=50) | 1.9x | 0.9x |
| CQP (n=500) | 3.0x | 1.2x |

**Pattern**: Cold overhead includes one-time compilation. Warm overhead is at or below 1.5x for all problem types - Optyx matches or beats raw SciPy on repeated solves.

---

## When to Use Optyx

### Ideal Use Cases

✅ **Parameter sweeps**: Solve similar problems with different parameters  
✅ **Real-time optimization**: Repeated solves with cached structure  
✅ **Prototyping**: Clean Python API, no manual gradients  
✅ **Large LP**: VectorVariable achieves parity with SciPy up to n=5,000  
✅ **Non-convex NLP**: Automatic differentiation with exact gradients  
✅ **Large NLP**: 800x faster than SciPy at n=5,000 for warm solves

### Consider Alternatives For

⚠️ **One-shot problems**: Cold-solve includes compilation overhead  
⚠️ **Large dense matrix problems (n>1000)**: CVXPY's specialized solvers may scale better  
⚠️ **Loop-based variables at scale**: Use VectorVariable instead

---

## Comparison with CVXPY

For convex problems, Optyx can be compared against CVXPY. Install with `uv sync --extra benchmarks`.

| Problem | Optyx | CVXPY | Overhead | Notes |
|---------|-------|-------|----------|-------|
| Small LP (2 vars) | 1.1ms | 1.0ms | 1.08x | Near parity |
| Medium LP (20 vars) | 1.3ms | 1.5ms | **0.85x** | Optyx faster |
| Simple QP | 0.4ms | 1.2ms | **0.33x** | Optyx 3x faster |
| Portfolio QP (n=10) | 3.6ms | 2.5ms | 1.47x | CVXPY's specialized QP solver |
| Portfolio QP (n=50) | 17.6ms | 1.7ms | 10.1x | CVXPY scales better for large QP |

::: {.callout-note}
## Optyx vs CVXPY: Different Strengths
- **LP/Simple QP**: Optyx matches or beats CVXPY
- **Dense Quadratic Programs**: CVXPY's specialized `quad_form` with interior-point solvers scales better for large portfolio optimization
- **Non-convex NLP**: Optyx supports non-convex objectives with autodiff; CVXPY requires convexity
:::

---

## Running Benchmarks

```bash
# All benchmarks
uv run pytest benchmarks/ -v

# By category
uv run pytest benchmarks/validation/ -v
uv run pytest benchmarks/performance/ -v
uv run pytest benchmarks/accuracy/ -v
uv run pytest benchmarks/comparison/ -v

# Generate plots
uv run python benchmarks/run_benchmarks.py
```

## Success Criteria

| Criterion | Target | Status |
|-----------|--------|--------|
| LP warm overhead | < 1.5x vs SciPy | ✅ ~1.0x |
| NLP warm overhead | < 3x vs SciPy | ✅ **0.001x** (800x faster at n=5000) |
| CQP warm overhead | < 2x vs SciPy | ✅ **1.0x** (parity) |
| VectorVariable scales | n > 1000 | ✅ n=5,000 tested |
| Gradient accuracy | < 1e-5 error | ✅ < 1e-10 |
| All validations pass | 100% | ✅ 100% |
